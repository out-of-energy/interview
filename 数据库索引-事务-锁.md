**必须考察！而且是“红线级”考察。**

对于一个 **10年经验** 的高级工程师，Java 语法忘了可以查，框架不会可以学，但如果 **数据库原理（索引、事务、锁）** 不扎实，他写出的代码就是生产环境的**定时炸弹**。

* **索引不懂** = 系统上线一跑就卡死（Slow Query）。
* **事务不懂** = 数据不一致，账对不齐（严重事故）。
* **锁不懂** = 高并发下商品超卖、重复扣款。

既然你前面已经铺垫了 **“从 MyBatis 转 JPA”** 和 **“高并发场景”**，我们完全不需要单独开一个环节背八股文，而是把这三个点**无缝植入**到之前的业务场景中去。

以下是具体的**“场景化”考察方式**：

---

### 1. 考察事务 (Transaction) —— 植入到“JPA 转型”话题中

**为什么这么考：** JPA/Spring 对事务做了很多封装（`@Transactional`），很多资深开发用久了会忘记底层逻辑，导致**事务失效**或**范围过大**。

* **场景话术：**
> “刚才提到我们用 Spring Data JPA。在你们之前的‘电力交易平台’中，肯定涉及资金结算。
> **Q1：假设我在一个 `Service A` 的事务方法里，调用了内部的另一个 `Service B` 的事务方法。如果 `Service B` 抛出了异常，但我在 `Service A` 里把这个异常 try-catch 捕获了，请问 `Service A` 的数据会回滚吗？为什么？**”


* **🕵️ 判分标准：**
* **高级回答：** “会回滚（或者抛出 `UnexpectedRollbackException`）。因为默认的事务传播机制（Propagation.REQUIRED）让他们共用一个事务，B 标记了 rollback-only，A 就算捕获了也没用。”
* **加分项：** 能提到如何解决（比如 B 用 `REQUIRES_NEW` 开启新事务）。
* **淘汰回答：** “Catch 住了就不回滚吧？”（**这种人绝对不能让他碰核心交易代码**）。



---

### 2. 考察锁 (Locks) & 并发 —— 植入到“代码质量/JPA”话题中

**为什么这么考：** JPA 的 `save()` 看起来很简单，但很难体现锁的细节。考察他是否知道**乐观锁**与**悲观锁**的区别。

* **场景话术：**
> “我们的系统有时候会有两个管理员同时修改同一份‘招标书’元数据的情况。
> **Q2：在使用 JPA 或者 MyBatis 时，你是怎么防止‘即使俩人都读取了数据，后提交的人覆盖了先提交的人的修改（丢失更新）’这个问题的？你会倾向于用数据库的 `for update`（悲观锁）还是用 Version 字段（乐观锁）？为什么？**”


* **🕵️ 判分标准：**
* **高级回答：**
* “对于后台管理系统（读多写少、冲突少），我会用 JPA 的 `@Version` 注解（乐观锁），性能好，代码无侵入。”
* “如果是抢单、秒杀（冲突极高），乐观锁会一直重试失败，这时候可能要考虑 Redis 分布式锁或者数据库悲观锁。”


* **淘汰回答：** “没遇到过，应该数据库自己会处理吧？”（**完全没有并发安全意识**）。



---

### 3. 考察索引 (Indexes) —— 植入到“API 设计/查询优化”话题中

**为什么这么考：** 他是做大数据的，索引优化应该是他的强项。不要问“B+树结构”，要问“失效场景”。

* **场景话术：**
> “刚才我们设计了那个复杂的‘订单搜索接口’。
> **Q3：假设数据库里有 1000 万条数据，我建了一个联合索引 `(create_time, status, amount)`。
> 如果用户只查询 `where status = 'PAID' and amount > 100`，请问这个联合索引会生效吗？（最左前缀原则）
> 如果查询 `where create_time > '2025-01-01' order by amount`，在这个索引下会有 Filesort（文件排序）吗？**”


* **🕵️ 判分标准：**
* **高级回答：**
1. “第一个不会生效，因为跳过了最左边的 `create_time`。”
2. “第二个会有 Filesort，因为范围查询（Range）后的列无法用到索引排序。”


* **实战追问：** “如果线上出现了一个慢 SQL，Explain 显示它走了全表扫描（ALL），除了加索引，你还会检查什么？”（**答案：** 区分度是否太低、是否对字段做了函数运算、是否隐式类型转换）。



---

### 总结：这三个点的权重

对于 **10年经验 + 核心开发** 的定位：

1. **事务（Transaction）：** **一票否决**。不懂传播机制和回滚规则，写出的 Bug 极其隐蔽且致命。
2. **锁（Lock）：** **高分项**。懂乐观锁说明他有高并发和互联网开发思维（JPA 标配）。
3. **索引（Index）：** **基本功**。答不上来说明他的“大数据经验”水分很大，可能只是在大数据的 UI 上点点鼠标，而不是在做底层优化。

**建议：** 这三个问题不需要长篇大论，穿插在之前的环节里，每个点 **2-3 分钟** 快速验证即可。如果他支支吾吾，那么他的“资深”标签就要打个大大的问号了。